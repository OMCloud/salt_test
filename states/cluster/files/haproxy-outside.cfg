global
    log         127.0.0.1 local2
 
    chroot      /usr/local/haproxy
    pidfile     /usr/local/haproxy/logs/haproxy.pid
    maxconn     4000
    user        root
    group       root
    daemon
 
    # turn on stats unix socket
    # 需要手工创建
    stats socket /var/lib/haproxy/stats
defaults
    mode                    http
    log                     global
    option                  http-keep-alive
    retries                 3
    timeout http-request    10s
    timeout queue           1m
    timeout connect         10s
    timeout client          1m
    timeout server          1m
    timeout http-keep-alive 10s
    timeout check           10s
    maxconn                 3000


listen stats
    bind                    0.0.0.0:8989
    stats                   enable
    stats uri               /haproxy-status
    stats auth              haproxy:saltstack

#---------------------------------------------------------------------
# main frontend which proxys to the backends
#---------------------------------------------------------------------
frontend  web_cluster
    bind 192.168.100.102:80
    mode http
    option httplog 
    default_backend             backend_web_cluster
 
#---------------------------------------------------------------------
# static backend for serving up images, stylesheets and such
#---------------------------------------------------------------------
backend backend_web_cluster
    balance     roundrobin
    server      web-node1  192.168.100.102:8080 check inter 2000 rise 30 fall 15
    server      web-node2  192.168.100.103:8080 check inter 2000 rise 30 fall 15

